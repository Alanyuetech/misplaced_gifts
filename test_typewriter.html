<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>打字机效果测试</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Microsoft YaHei", sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        .test-container {
            background: #f0f0f0;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .text-display {
            background: white;
            padding: 15px;
            min-height: 200px;
            border-radius: 5px;
            white-space: pre-wrap;
            line-height: 1.6;
        }
        .controls {
            margin-top: 20px;
        }
        button {
            padding: 10px 20px;
            margin-right: 10px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background: #45a049;
        }
        .info {
            background: #fffacd;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        .status {
            margin-top: 10px;
            padding: 10px;
            background: #e0e0e0;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <h1>打字机效果测试</h1>
    
    <div class="info">
        <strong>测试说明：</strong>
        <ul>
            <li>点击"开始打字机"按钮，文字将以打字机效果显示</li>
            <li>按空格键应该立即显示全部文字</li>
            <li>不应该出现文字重复或乱码</li>
            <li>多次按空格键不应该有副作用</li>
        </ul>
    </div>

    <div class="test-container">
        <div id="text-display" class="text-display"></div>
        <div class="status">
            状态：<span id="status">就绪</span><br>
            正在打字：<span id="typing-status">否</span><br>
            定时器状态：<span id="timer-status">无</span>
        </div>
        <div class="controls">
            <button onclick="startTypewriter()">开始打字机</button>
            <button onclick="testSkip()">模拟空格键</button>
            <button onclick="clearText()">清空文本</button>
            <button onclick="startStress()">压力测试</button>
        </div>
    </div>

    <script>
        // 测试文本
        const testText = `"啧，"一个带着点慵懒笑意的声音在刘枭房门外响起，低沉悦耳，"Xavier，再这么熬下去，我看你家公司的股价还没崩，你这张脸先要崩了。真成夜猫子了~"

"不过呢，"他话锋一转，像变魔术似的，手腕一翻将一个装着游戏兑换码的信封举到刘枭面前，带着点不容置疑的意味。深黑磨砂的封面上，用暗红色、仿佛干涸血液般扭曲的字体印着一个触目惊心的单词——《Pain》。`;

        // 模拟游戏类的属性
        let typewriterTimer = null;
        let isTyping = false;
        let currentText = '';
        let textSpeed = 50;

        // 清除打字机效果
        function clearTypewriter() {
            if (typewriterTimer) {
                clearTimeout(typewriterTimer);
                typewriterTimer = null;
            }
            isTyping = false;
            updateStatus();
        }

        // 开始打字机效果
        function startTypewriter() {
            // 清除之前的效果
            clearTypewriter();
            
            const display = document.getElementById('text-display');
            display.innerHTML = '';
            
            // 保存当前文本
            currentText = testText;
            
            // 开始打字
            isTyping = true;
            let index = 0;
            const speed = 101 - textSpeed;
            
            updateStatus();
            
            const typeWriter = () => {
                if (index < testText.length && isTyping) {
                    display.textContent += testText.charAt(index);
                    index++;
                    typewriterTimer = setTimeout(typeWriter, speed);
                    updateStatus();
                } else {
                    isTyping = false;
                    typewriterTimer = null;
                    updateStatus();
                }
            };
            
            typeWriter();
        }

        // 跳过文本（模拟空格键）
        function testSkip() {
            if (isTyping) {
                clearTypewriter();
                const display = document.getElementById('text-display');
                display.textContent = currentText;
                console.log('文本已跳过');
            }
        }

        // 清空文本
        function clearText() {
            clearTypewriter();
            document.getElementById('text-display').innerHTML = '';
            currentText = '';
            updateStatus();
        }

        // 更新状态显示
        function updateStatus() {
            document.getElementById('status').textContent = isTyping ? '打字中' : '就绪';
            document.getElementById('typing-status').textContent = isTyping ? '是' : '否';
            document.getElementById('timer-status').textContent = typewriterTimer ? '活动' : '无';
        }

        // 压力测试
        function startStress() {
            console.log('开始压力测试...');
            let count = 0;
            
            const stressTest = () => {
                if (count < 10) {
                    if (count % 2 === 0) {
                        startTypewriter();
                        console.log(`测试 ${count + 1}: 开始打字机`);
                    } else {
                        setTimeout(() => {
                            testSkip();
                            console.log(`测试 ${count + 1}: 跳过文本`);
                        }, 500);
                    }
                    count++;
                    setTimeout(stressTest, 1000);
                } else {
                    console.log('压力测试完成');
                }
            };
            
            stressTest();
        }

        // 监听空格键
        document.addEventListener('keydown', (e) => {
            if (e.key === ' ') {
                e.preventDefault();
                testSkip();
            }
        });

        // 初始化
        updateStatus();
    </script>
</body>
</html>