<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>调试游戏启动</title>
    <style>
        .debug-info {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 15px;
            border-radius: 5px;
            max-width: 400px;
            max-height: 500px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
            z-index: 100000;
        }
        .debug-line {
            margin: 5px 0;
            padding: 3px;
            border-left: 3px solid #4CAF50;
        }
        .error {
            border-left-color: #f44336;
            color: #ff9999;
        }
        .warn {
            border-left-color: #ff9800;
            color: #ffcc99;
        }
    </style>
</head>
<body>
    <div class="debug-info" id="debug-info">
        <h3>调试信息</h3>
        <div id="debug-log"></div>
    </div>
    
    <iframe src="index.html" style="width: 100%; height: 600px; border: 1px solid #ccc;"></iframe>
    
    <script>
        const debugLog = document.getElementById('debug-log');
        let logCount = 0;
        
        function addLog(message, type = 'info') {
            const line = document.createElement('div');
            line.className = `debug-line ${type}`;
            line.textContent = `[${++logCount}] ${new Date().toLocaleTimeString()}: ${message}`;
            debugLog.appendChild(line);
            debugLog.scrollTop = debugLog.scrollHeight;
        }
        
        // 监听iframe加载
        const iframe = document.querySelector('iframe');
        iframe.onload = function() {
            addLog('iframe 加载完成');
            
            try {
                const iframeWindow = iframe.contentWindow;
                const iframeDocument = iframe.contentDocument;
                
                // 检查关键元素
                const welcomeScreen = iframeDocument.getElementById('welcome-screen');
                const startBtn = iframeDocument.getElementById('start-game-btn');
                
                addLog(`欢迎界面: ${welcomeScreen ? '找到' : '未找到'}`);
                addLog(`开始按钮: ${startBtn ? '找到' : '未找到'}`);
                
                // 检查game对象
                if (iframeWindow.game) {
                    addLog('游戏对象已创建');
                    addLog(`当前场景: ${iframeWindow.game.currentScene}`);
                    addLog(`游戏已开始: ${iframeWindow.game.gameStarted}`);
                } else {
                    addLog('游戏对象未创建', 'error');
                }
                
                // 拦截console.log
                const originalLog = iframeWindow.console.log;
                iframeWindow.console.log = function(...args) {
                    originalLog.apply(iframeWindow.console, args);
                    addLog('Console: ' + args.join(' '));
                };
                
                // 拦截console.error
                const originalError = iframeWindow.console.error;
                iframeWindow.console.error = function(...args) {
                    originalError.apply(iframeWindow.console, args);
                    addLog('Error: ' + args.join(' '), 'error');
                };
                
                // 监听按钮点击
                if (startBtn) {
                    addLog('添加按钮点击监听器');
                    startBtn.addEventListener('click', function() {
                        addLog('检测到按钮点击事件');
                    });
                }
                
                // 检查是否有JavaScript错误
                iframeWindow.addEventListener('error', function(e) {
                    addLog(`JS错误: ${e.message} at ${e.filename}:${e.lineno}:${e.colno}`, 'error');
                });
                
            } catch (e) {
                addLog(`设置调试失败: ${e.message}`, 'error');
            }
        };
        
        // 定期检查游戏状态
        setInterval(() => {
            try {
                const iframeWindow = iframe.contentWindow;
                if (iframeWindow && iframeWindow.game) {
                    const status = `场景: ${iframeWindow.game.currentScene}, 已开始: ${iframeWindow.game.gameStarted}`;
                    document.title = status;
                }
            } catch (e) {
                // 忽略跨域错误
            }
        }, 1000);
    </script>
</body>
</html>